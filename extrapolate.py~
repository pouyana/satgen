#!/usr/bin/env python
# -*- coding: utf-8 -*-
import sys,os
import tempfile
import platform
import datetime
import shutil
from time import sleep
import re
from config_dict import ConfigDict
from database import DB

class Extrapolate():
    """
    Extrapolate generated satellites.
    With the help of database search
    """
    def set_root(self, root):
        """
        Sets the root folder for the simulation files
        """
        self.root = root

    def get_root(self):
        """
        Retruns root
        """
        return self.root
    
    def get_file_list(self):
        """
        returns the files listed in root folder
        """
        return os.listdir(self.get_root())
    
    def get_name(self,file_name):
        """
        returns the sat name in database from the filename
        """
        f=file_name.split("_a_sim.xml")[0]
        return f
    
    def extraploate(self):
        import subprocess, shlex
        db=DB("satgen.db")
        for f in self.get_file_list():
            if(os.path.splitext(f)[1]==".xml" and not re.search("out",f)):
                object_id=db.get_sat_id_by_name(self.get_name(f))
                print object_id
                os.chdir(self.get_root())
                option=" -i " + os.path.abspath(f) + " -o " + os.path.abspath(f)+"_out"         
                os.chdir("/home/poa32kc/Programs/Stela/bin")                    
                command_line = "./stela-batch.sh"+option
                args = shlex.split(command_line)
                CR = subprocess.call(args)
                os.chdir(self.get_root())

ex=Extrapolate()
ex.set_root("/home/poa32kc/Programs/Python/satgen/sim/")
print ex.get_file_list()
ex.extraploate()



